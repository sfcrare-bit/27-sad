<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>27-—è –°–ê–î - –°–∏—Ä–∏–π—Å–∫–∏–π –∫–æ–Ω—Ç–∏–Ω–≥–µ–Ω—Ç</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body::before{content:'';position:fixed;top:0;left:0;width:100%;height:100%;background:url('https://imgfy.ru/ib/gZXDo0AEHolO3hs_1766686495.png') center/cover no-repeat fixed;filter:blur(6px) brightness(0.8);z-index:-2}
        body::after{content:'';position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,0.3);z-index:-1}
        body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;color:#2c1810;min-height:100vh;padding:20px;position:relative}
        .container{max-width:1400px;margin:0 auto;background-color:rgba(255,248,235,0.92);border-radius:15px;box-shadow:0 10px 30px rgba(107,82,52,0.6);border:3px solid #8a6d46;overflow:hidden;position:relative;z-index:1}
        header{background:linear-gradient(to right,#6b5234,#8a6d46,#b08d57);color:#fff8eb;padding:25px;text-align:center;border-bottom:5px solid #2c1810}
        header h1{font-size:2.8rem;text-shadow:3px 3px 5px rgba(44,24,16,0.5);letter-spacing:2px}
        header h2{font-size:1.4rem;margin-top:10px;opacity:0.9;font-weight:300}
        .sand-stripe{height:10px;background:repeating-linear-gradient(90deg,#d4a762,#d4a762 10px,#b08d57 10px,#b08d57 20px)}
        .stats-bar{display:flex;justify-content:space-around;background-color:rgba(44,24,16,0.95);color:#d4a762;padding:12px;font-size:0.9rem;font-weight:bold;border-bottom:2px solid #8a6d46;flex-wrap:wrap}
        .unit-section{padding:25px;border-bottom:2px dashed #b08d57}
        .unit-section:last-child{border-bottom:none}
        .unit-title{color:#6b5234;font-size:1.8rem;margin-bottom:20px;padding-left:15px;border-left:6px solid #b08d57;display:flex;align-items:center;gap:12px}
        .person-card{background:linear-gradient(to right,#fff8eb,#f5e9d3);border:2px solid #d4a762;border-radius:10px;padding:18px;margin:15px 0;display:flex;justify-content:space-between;align-items:center;transition:transform 0.3s,box-shadow 0.3s;box-shadow:0 4px 8px rgba(107,82,52,0.15)}
        .person-card:hover{transform:translateY(-3px);box-shadow:0 8px 16px rgba(107,82,52,0.25);border-color:#8a6d46}
        .person-info h3{color:#2c1810;font-size:1.3rem;margin-bottom:5px}
        .person-info p{color:#6b5234;font-size:1rem;margin:4px 0}
        .status{padding:8px 16px;border-radius:20px;font-weight:bold;font-size:0.9rem;min-width:120px;text-align:center}
        .status-active{background-color:rgba(76,175,80,0.2);color:#2e7d32;border:2px solid #2e7d32}
        .status-reserve{background-color:rgba(255,193,7,0.2);color:#ff8f00;border:2px solid #ff8f00}
        .status-vagner{background-color:rgba(121,85,72,0.2);color:#5d4037;border:2px solid #5d4037}
        .status-senezh{background-color:rgba(33,150,243,0.2);color:#1565c0;border:2px solid #1565c0}
        .status-police{background-color:rgba(63,81,181,0.2);color:#283593;border:2px solid #283593}
        .admin-panel{background-color:rgba(44,24,16,0.95);color:#fff8eb;padding:25px;margin-top:30px;border-radius:10px;border:3px solid #b08d57}
        .admin-panel h3{color:#d4a762;margin-bottom:20px;font-size:1.6rem;text-align:center}
        .form-row{display:flex;flex-wrap:wrap;gap:15px;margin-bottom:20px}
        .form-group{flex:1;min-width:200px}
        .form-group label{display:block;margin-bottom:8px;color:#b08d57;font-weight:bold}
        .form-group input,.form-group select{width:100%;padding:12px;border:2px solid #8a6d46;border-radius:8px;background-color:#fff8eb;color:#2c1810;font-size:1rem}
        .form-group input:focus,.form-group select:focus{outline:none;border-color:#d4a762;box-shadow:0 0 0 3px rgba(212,167,98,0.3)}
        button{background:linear-gradient(to bottom,#b08d57,#8a6d46);color:white;border:none;padding:14px 28px;border-radius:8px;font-size:1.1rem;font-weight:bold;cursor:pointer;transition:all 0.3s;border:2px solid #6b5234;margin:5px}
        button:hover{background:linear-gradient(to bottom,#c9a268,#9d7c4f);transform:translateY(-2px);box-shadow:0 6px 12px rgba(107,82,52,0.4)}
        .delete-btn{background:linear-gradient(to bottom,#d32f2f,#b71c1c);border:2px solid #7f0000}
        .delete-btn:hover{background:linear-gradient(to bottom,#e53935,#c62828)}
        .controls{display:flex;justify-content:center;gap:20px;margin-top:25px;flex-wrap:wrap}
        footer{text-align:center;padding:25px;color:#6b5234;font-size:0.9rem;border-top:2px solid #d4a762;margin-top:30px}
        .unit-icon{font-size:1.8rem}
        .columns-container{display:grid;grid-template-columns:repeat(auto-fit,minmax(500px,1fr));gap:30px;margin-top:20px}
        .column-section{background:rgba(255,248,235,0.85);border-radius:10px;padding:20px;border:2px solid #d4a762;max-height:500px;overflow-y:auto;overflow-x:hidden}
        .column-section::-webkit-scrollbar{width:8px}
        .column-section::-webkit-scrollbar-track{background:#f5e9d3;border-radius:4px}
        .column-section::-webkit-scrollbar-thumb{background:#b08d57;border-radius:4px}
        .column-section::-webkit-scrollbar-thumb:hover{background:#8a6d46}
        .column-title{color:#6b5234;font-size:1.4rem;margin-bottom:15px;padding-left:10px;border-left:5px solid #8a6d46;display:flex;align-items:center;gap:10px;position:sticky;top:0;background:rgba(255,248,235,0.95);padding:10px;margin:-10px -10px 15px -10px;z-index:1}
        @media (max-width:1100px){.columns-container{grid-template-columns:1fr}}
        @media (max-width:768px){header h1{font-size:2rem}.person-card{flex-direction:column;align-items:flex-start;gap:15px}.status{align-self:flex-start}.form-row{flex-direction:column}.controls{flex-direction:column}button{width:100%}.stats-bar{flex-direction:column;gap:10px;align-items:center}.columns-container{grid-template-columns:1fr}.column-section{max-height:400px}}
        .no-select{user-select:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none}
    </style>
</head>
<body class="no-select">
    <div class="container">
        <header>
            <h1>27-—è –°–ú–ï–®–ê–ù–ù–ê–Ø –ê–í–ò–ê–¶–ò–û–ù–ù–ê–Ø –î–ò–í–ò–ó–ò–Ø</h1>
            <h2>–°–∏—Ä–∏–π—Å–∫–∏–π –ö–æ–Ω—Ç–∏–Ω–≥–µ–Ω—Ç | –ó–æ–Ω–∞ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏: –ê–ª–ª–µ–ø–æ</h2>
        </header>
        
        <div class="sand-stripe"></div>
        
        <div class="stats-bar">
            <div>üõ°Ô∏è –û–±—â–∞—è —á–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç—å: <span id="totalCount">0</span> —á–µ–ª.</div>
            <div>‚úÖ –ë–æ–µ–≤–∞—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å: <span id="activeCount">0</span> —á–µ–ª.</div>
            <div>‚è∏ –í —Ä–µ–∑–µ—Ä–≤–µ: <span id="reserveCount">0</span> —á–µ–ª.</div>
            <div>üå°Ô∏è –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: +42¬∞C</div>
        </div>

        <div class="unit-section">
            <div class="unit-title">üéñÔ∏è –ö–û–ú–ê–ù–î–û–í–ê–ù–ò–ï 27-–π –°–ê–î</div>
            <div id="commandList"></div>
        </div>

        <div class="unit-section">
            <div class="unit-title"><span class="unit-icon">üõ©Ô∏è</span> 37-–π –°–ú–ï–®–ê–ù–ù–´–ô –ê–í–ò–ê–¶–ò–û–ù–ù–´–ô –ü–û–õ–ö (–°–ê–ü)</div>
            <div id="sap37List"></div>
        </div>

        <div class="unit-section">
            <div class="unit-title"><span class="unit-icon">ü™ñ</span> 382-–π –û–¢–î–ï–õ–¨–ù–´–ô –ë–ê–¢–ê–õ–¨–û–ù –ú–û–†–°–ö–û–ô –ü–ï–•–û–¢–´ (–û–ë–ú–ü)</div>
            
            <div class="columns-container">
                <div class="column-section">
                    <div class="column-title">üìã –®—Ç–∞–± –∏ –ø–µ—Ö–æ—Ç–Ω—ã–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è</div>
                    <div id="bmp382List"></div>
                </div>
                
                <div class="column-section">
                    <div class="column-title">‚ö° –¢–ê–ù–ö–û–í–ê–Ø –†–û–¢–ê</div>
                    <div id="tankList"></div>
                </div>
            </div>
        </div>

        <div class="unit-section">
            <div class="unit-title"><span class="unit-icon">üéØ</span> 94-—è –ë–ê–¢–ê–†–ï–Ø –ë–ï–†–ï–ì–û–í–û–ô –ê–†–¢–ò–õ–õ–ï–†–ò–ò (–ë–ë–ê)</div>
            <div id="bba94List"></div>
        </div>

        <div class="unit-section">
            <div class="unit-title"><span class="unit-icon">üëÆ</span> –í–û–ï–ù–ù–ê–Ø –ü–û–õ–ò–¶–ò–Ø (–í–ü) 27-–π –°–ê–î</div>
            <div id="policeList"></div>
        </div>

        <div class="unit-section">
            <div class="unit-title"><span class="unit-icon">üî±</span> –°–ò–õ–´ –°–ü–ï–¶–ò–ê–õ–¨–ù–´–• –û–ü–ï–†–ê–¶–ò–ô –¶–°–ù "–°–ï–ù–ï–ñ" (–°–°–û –¶–°–ù "–°–µ–Ω–µ–∂")</div>
            <div id="senezhList"></div>
        </div>

        <div class="unit-section">
            <div class="unit-title"><span class="unit-icon">‚öîÔ∏è</span> –ß–í–ö "–í–ê–ì–ù–ï–†"</div>
            <div id="vagnerList"></div>
        </div>

        <div class="admin-panel" id="adminPanel">
            <div style="text-align: center; margin-bottom: 20px;">
                <input type="password" id="adminPassword" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞" style="padding: 10px; width: 300px;">
                <button onclick="checkAdminPassword()">–í–æ–π—Ç–∏ –≤ —Ä–µ–∂–∏–º –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</button>
            </div>
            
            <div id="adminContent" style="display: none;">
                <h3>üîê –ü–ê–ù–ï–õ–¨ –£–ü–†–ê–í–õ–ï–ù–ò–Ø –û–®–°</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="personName">–§–ò–û:</label>
                        <input type="text" id="personName" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á">
                    </div>
                    <div class="form-group">
                        <label for="personPosition">–î–æ–ª–∂–Ω–æ—Å—Ç—å:</label>
                        <input type="text" id="personPosition" placeholder="–ö–æ–º–∞–Ω–¥–∏—Ä –≤–∑–≤–æ–¥–∞">
                    </div>
                    <div class="form-group">
                        <label for="personRank">–ó–≤–∞–Ω–∏–µ:</label>
                        <input type="text" id="personRank" placeholder="–ú–∞–π–æ—Ä">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="personUnit">–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ:</label>
                        <select id="personUnit">
                            <option value="command">–ö–æ–º–∞–Ω–¥–æ–≤–∞–Ω–∏–µ 27-–π –°–ê–î</option>
                            <option value="sap37">37-–π –°–º–µ—à–∞–Ω–Ω—ã–π –ê–≤–∏–∞—Ü–∏–æ–Ω–Ω—ã–π –ü–æ–ª–∫</option>
                            <option value="bmp382">382-–π –û—Ç–¥–µ–ª—å–Ω—ã–π –±–∞—Ç–∞–ª—å–æ–Ω –ú–æ—Ä—Å–∫–æ–π –ü–µ—Ö–æ—Ç—ã</option>
                            <option value="tank">–¢–∞–Ω–∫–æ–≤–∞—è —Ä–æ—Ç–∞ 382-–π –û–ë–ú–ü</option>
                            <option value="bba94">94-—è –ë–∞—Ç–∞—Ä–µ—è –ë–µ—Ä–µ–≥–æ–≤–æ–π –ê—Ä—Ç–∏–ª–ª–µ—Ä–∏–∏</option>
                            <option value="police">–í–æ–µ–Ω–Ω–∞—è –ü–æ–ª–∏—Ü–∏—è 27-–π –°–ê–î</option>
                            <option value="senezh">–°–°–û –¶–°–ù "–°–µ–Ω–µ–∂"</option>
                            <option value="vagner">–ß–í–ö "–í–∞–≥–Ω–µ—Ä"</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="personStatus">–°—Ç–∞—Ç—É—Å:</label>
                        <select id="personStatus">
                            <option value="active">‚úÖ –ë–æ–µ–≤–∞—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å</option>
                            <option value="reserve">‚è∏ –í —Ä–µ–∑–µ—Ä–≤–µ</option>
                            <option value="leave">‚úàÔ∏è –í –æ—Ç–ø—É—Å–∫–µ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="personDetails">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:</label>
                        <input type="text" id="personDetails" placeholder="–ù–∞–ª—ë—Ç, –≤–æ–æ—Ä—É–∂–µ–Ω–∏–µ, —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è">
                    </div>
                </div>
                
                <div class="controls">
                    <button onclick="addFighter()">‚ûï –î–û–ë–ê–í–ò–¢–¨ –ë–û–ô–¶–ê</button>
                    <button onclick="updateStats()">üìä –û–ë–ù–û–í–ò–¢–¨ –°–¢–ê–¢–ò–°–¢–ò–ö–£</button>
                </div>
                
                <div style="text-align: center; margin-top: 20px; color: #b08d57; font-size: 0.9rem;">
                    üí° –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –æ–±—â–µ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö. –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤–∏–¥–Ω—ã –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º.
                </div>
            </div>
        </div>

        <footer>
            <p>27-—è –°–º–µ—à–∞–Ω–Ω–∞—è –ê–≤–∏–∞—Ü–∏–æ–Ω–Ω–∞—è –î–∏–≤–∏–∑–∏—è | –°–∏—Ä–∏—è, –ê–ª–ª–µ–ø–æ | 2016</p>
            <p>–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ —Å–æ—Å—Ç–∞–≤: –∑–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É –≤—ã—à–µ –∏ –Ω–∞–∂–º–∏—Ç–µ "–î–æ–±–∞–≤–∏—Ç—å –±–æ–π—Ü–∞"</p>
        </footer>
    </div>

            let supabaseClient = null;
const SUPABASE_URL = 'https://kyxnkteujlntyhhcsnnz.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt5eG5rdGV1amxudHloaGNzbm56Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY2MjEwNTMsImV4cCI6MjA4MjE5NzA1M30.Fvwr4xFPkHd63GwZ9KRFVgSPlx6HLoF_hpfR6AwGCL4';

async function sha256Hash(input) {
    const encoder = new TextEncoder();
    const data = encoder.encode(input);
    const hashBuffer = await crypto.subtle.digest('SHA-256', data);
    const hashArray = Array.from(new Uint8Array(hashBuffer));
    return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
}

function xorEncrypt(text, key = 'SAD27_2025_SECRET') {
    let result = '';
    for (let i = 0; i < text.length; i++) {
        result += String.fromCharCode(text.charCodeAt(i) ^ key.charCodeAt(i % key.length));
    }
    return btoa(result);
}

function xorDecrypt(encrypted, key = 'SAD27_2025_SECRET') {
    const text = atob(encrypted);
    let result = '';
    for (let i = 0; i < text.length; i++) {
        result += String.fromCharCode(text.charCodeAt(i) ^ key.charCodeAt(i % key.length));
    }
    return result;
}

let passwordCache = null;
let loginAttempts = 0;
const MAX_ATTEMPTS = 3;
const LOCKOUT_TIME = 180000;

async function generateSecurePassword() {
    if (passwordCache) return passwordCache;
    
    const now = new Date();
    const day = now.getDate();
    const month = now.getMonth() + 1;
    const year = now.getFullYear();
    
    const base = "27SAD";
    const seed = (day * month * year) % 999;
    const checksum = ((day + month + year) * 27) % 1000;
    const dateStr = `${day}${month}${year}`;
    
    const hashInput = base + seed + checksum + dateStr;
    const hash = await sha256Hash(hashInput);
    
    passwordCache = `${base}${seed.toString().padStart(3,'0')}${checksum.toString().padStart(3,'0')}${hash.substring(0,4).toUpperCase()}`;
    
    setTimeout(() => { passwordCache = null; }, 3600000);
    
    return passwordCache;
}

async function checkAdminPassword() {
    if (loginAttempts >= MAX_ATTEMPTS) {
        alert('üö´ –î–æ—Å—Ç—É–ø –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
        return;
    }
    
    const input = document.getElementById('adminPassword').value.trim();
    if (!input) {
        alert('–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å');
        return;
    }
    
    const hashedInput = await sha256Hash(input);
    const correctPassword = await generateSecurePassword();
    const hashedCorrect = await sha256Hash(correctPassword);
    
    const loginTime = new Date().toISOString();
    const encryptedLog = xorEncrypt(`ATTEMPT:${loginTime}:${input.substring(0,1)}***`);
    
    if (hashedInput === hashedCorrect) {
        const sessionToken = await sha256Hash(correctPassword + Date.now());
        localStorage.setItem('adminSession', xorEncrypt(sessionToken));
        localStorage.setItem('sessionExpiry', Date.now() + 3600000);
        
        document.getElementById('adminContent').style.display = 'block';
        document.getElementById('adminPassword').value = '';
        document.getElementById('adminPassword').style.display = 'none';
        document.getElementById('loginButton').style.display = 'none';
        
        loginAttempts = 0;
        localStorage.setItem('loginAttempts', '0');
        
        const successLog = xorEncrypt(`SUCCESS:${loginTime}:${sessionToken.substring(0,8)}`);
        console.log('[SECURE_LOG]', successLog);
        
        await loadFighters();
        alert('‚úÖ –î–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à–µ–Ω. –°–µ—Å—Å–∏—è –∞–∫—Ç–∏–≤–Ω–∞ 1 —á–∞—Å.');
    } else {
        loginAttempts++;
        localStorage.setItem('loginAttempts', loginAttempts.toString());
        
        const failLog = xorEncrypt(`FAILED:${loginTime}:${loginAttempts}`);
        console.log('[SECURE_LOG]', failLog);
        
        alert(`‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å! –ü–æ–ø—ã—Ç–∫–∞ ${loginAttempts}/${MAX_ATTEMPTS}`);
        
        if (loginAttempts >= MAX_ATTEMPTS) {
            alert('üö´ –ü—Ä–µ–≤—ã—à–µ–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫. –î–æ—Å—Ç—É–ø –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –Ω–∞ 3 –º–∏–Ω—É—Ç—ã.');
            setTimeout(() => {
                loginAttempts = 0;
                localStorage.setItem('loginAttempts', '0');
            }, LOCKOUT_TIME);
        }
    }
}

function checkSession() {
    const session = localStorage.getItem('adminSession');
    const expiry = localStorage.getItem('sessionExpiry');
    
    if (!session || !expiry) return false;
    if (Date.now() > parseInt(expiry)) {
        localStorage.removeItem('adminSession');
        localStorage.removeItem('sessionExpiry');
        return false;
    }
    
    try {
        xorDecrypt(session);
        return true;
    } catch {
        return false;
    }
}

async function initSupabase() {
    const storedAttempts = localStorage.getItem('loginAttempts');
    loginAttempts = parseInt(storedAttempts || '0');
    
    if (checkSession()) {
        document.getElementById('adminContent').style.display = 'block';
        document.getElementById('adminPassword').style.display = 'none';
        document.getElementById('loginButton').style.display = 'none';
    }
    
    supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
    await loadFighters();
}

async function loadFighters() {
    if (!supabaseClient) return;
    
    try {
        const { data, error } = await supabaseClient
            .from('fighters')
            .select('*')
            .order('unit', { ascending: true })
            .order('created_at', { ascending: true });
        
        if (error) {
            const errorLog = xorEncrypt(`DB_ERROR:${new Date().toISOString()}:${error.message.substring(0,20)}`);
            console.log('[SECURE_LOG]', errorLog);
            return;
        }
        
        const containers = {
            command: 'commandList',
            sap37: 'sap37List',
            bmp382: 'bmp382List',
            tank: 'tankList',
            bba94: 'bba94List',
            police: 'policeList',
            senezh: 'senezhList',
            vagner: 'vagnerList'
        };
        
        Object.values(containers).forEach(id => {
            const el = document.getElementById(id);
            if (el) el.innerHTML = '';
        });
        
        if (data && data.length > 0) {
            data.forEach(fighter => {
                addFighterToDOM(fighter);
            });
            updateStats();
        }
    } catch (error) {
        const errorLog = xorEncrypt(`LOAD_ERROR:${new Date().toISOString()}:${error.message.substring(0,20)}`);
        console.log('[SECURE_LOG]', errorLog);
    }
}

function addFighterToDOM(fighter) {
    const statusMap = {
        active: {text: '‚úÖ –ë–æ–µ–≤–∞—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å', class: 'status-active'},
        reserve: {text: '‚è∏ –í —Ä–µ–∑–µ—Ä–≤–µ', class: 'status-reserve'},
        leave: {text: '‚úàÔ∏è –í –æ—Ç–ø—É—Å–∫–µ', class: 'status-reserve'}
    };
    
    const status = statusMap[fighter.status] || statusMap.reserve;
    let statusClass = status.class;
    
    if (fighter.unit === 'senezh') statusClass = 'status-senezh';
    else if (fighter.unit === 'vagner') statusClass = 'status-vagner';
    else if (fighter.unit === 'police') statusClass = 'status-police';
    
    const card = document.createElement('div');
    card.className = 'person-card';
    card.dataset.id = fighter.id;
    
    card.innerHTML = `
        <div class="person-info">
            <h3>${fighter.name}</h3>
            <p>${fighter.position} | ${fighter.rank}</p>
            ${fighter.details ? `<p>${fighter.details}</p>` : ''}
        </div>
        <div class="status ${statusClass}">${status.text}</div>
    `;
    
    if (checkSession()) {
        const deleteBtn = document.createElement('button');
        deleteBtn.textContent = 'üóëÔ∏è';
        deleteBtn.className = 'delete-btn';
        deleteBtn.style.cssText = 'padding:5px 10px;font-size:0.8rem;margin-left:10px;';
        deleteBtn.onclick = () => deleteFighter(fighter.id);
        card.querySelector('.person-info').appendChild(deleteBtn);
    }
    
    const containerId = {
        command: 'commandList',
        sap37: 'sap37List',
        bmp382: 'bmp382List',
        tank: 'tankList',
        bba94: 'bba94List',
        police: 'policeList',
        senezh: 'senezhList',
        vagner: 'vagnerList'
    }[fighter.unit];
    
    if (containerId && document.getElementById(containerId)) {
        document.getElementById(containerId).appendChild(card);
    }
}

async function addFighter() {
    if (!supabaseClient || !checkSession()) {
        alert('‚ùå –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞');
        return;
    }
    
    const name = document.getElementById('personName')?.value.trim();
    const position = document.getElementById('personPosition')?.value.trim();
    const rank = document.getElementById('personRank')?.value.trim();
    
    if (!name || !position || !rank) {
        alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –§–ò–û, –î–æ–ª–∂–Ω–æ—Å—Ç—å –∏ –ó–≤–∞–Ω–∏–µ');
        return;
    }
    
    const fighter = {
        name: name,
        position: position,
        rank: rank,
        unit: document.getElementById('personUnit')?.value || 'command',
        status: document.getElementById('personStatus')?.value || 'active',
        details: document.getElementById('personDetails')?.value.trim() || ''
    };
    
    const logTime = new Date().toISOString();
    const logData = xorEncrypt(`ADD_FIGHTER:${logTime}:${name.substring(0,10)}`);
    console.log('[SECURE_LOG]', logData);
    
    try {
        const { data, error } = await supabaseClient
            .from('fighters')
            .insert([fighter])
            .select();
        
        if (error) {
            const errorLog = xorEncrypt(`INSERT_ERROR:${logTime}:${error.message.substring(0,20)}`);
            console.log('[SECURE_LOG]', errorLog);
            alert('–û—à–∏–±–∫–∞: ' + error.message);
            return;
        }
        
        if (data && data[0]) {
            addFighterToDOM(data[0]);
            updateStats();
            
            ['personName', 'personPosition', 'personRank', 'personDetails'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.value = '';
            });
            
            alert(`–ë–æ–µ—Ü ${name} –¥–æ–±–∞–≤–ª–µ–Ω`);
        }
    } catch (error) {
        const errorLog = xorEncrypt(`CATCH_ERROR:${logTime}:${error.message.substring(0,20)}`);
        console.log('[SECURE_LOG]', errorLog);
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏: ' + error.message);
    }
}

async function deleteFighter(id) {
    if (!supabaseClient || !checkSession() || !confirm('–£–¥–∞–ª–∏—Ç—å –±–æ–π—Ü–∞?')) return;
    
    const logTime = new Date().toISOString();
    const logData = xorEncrypt(`DELETE_FIGHTER:${logTime}:${id}`);
    console.log('[SECURE_LOG]', logData);
    
    try {
        const { error } = await supabaseClient
            .from('fighters')
            .delete()
            .eq('id', id);
        
        if (error) {
            const errorLog = xorEncrypt(`DELETE_ERROR:${logTime}:${error.message.substring(0,20)}`);
            console.log('[SECURE_LOG]', errorLog);
            alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ' + error.message);
            return;
        }
        
        document.querySelector(`.person-card[data-id="${id}"]`)?.remove();
        updateStats();
        alert('–ë–æ–µ—Ü —É–¥–∞–ª–µ–Ω');
    } catch (error) {
        const errorLog = xorEncrypt(`DELETE_CATCH:${logTime}:${error.message.substring(0,20)}`);
        console.log('[SECURE_LOG]', errorLog);
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏: ' + error.message);
    }
}

function updateStats() {
    const cards = document.querySelectorAll('.person-card');
    const activeCards = Array.from(cards).filter(card => 
        card.querySelector('.status').textContent.includes('‚úÖ')
    );
    
    const totalEl = document.getElementById('totalCount');
    const activeEl = document.getElementById('activeCount');
    const reserveEl = document.getElementById('reserveCount');
    
    if (totalEl) totalEl.textContent = cards.length;
    if (activeEl) activeEl.textContent = activeCards.length;
    if (reserveEl) reserveEl.textContent = cards.length - activeCards.length;
}

document.addEventListener('DOMContentLoaded', () => {
    document.addEventListener('copy', (e) => {
        e.preventDefault();
        alert('–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–µ—â–µ–Ω–æ!');
    });
    
    document.addEventListener('keydown', (e) => {
        if (e.keyCode === 123 || 
            (e.ctrlKey && e.shiftKey && e.keyCode === 73) ||
            (e.ctrlKey && e.shiftKey && e.keyCode === 74) ||
            (e.ctrlKey && e.keyCode === 85)) {
            e.preventDefault();
            return false;
        }
    });
    
    initSupabase();
    
    setInterval(() => {
        if (!checkSession() && document.getElementById('adminContent')?.style.display === 'block') {
            localStorage.removeItem('adminSession');
            localStorage.removeItem('sessionExpiry');
            window.location.reload();
        }
    }, 60000);
});
    </script>
</body>
</html>